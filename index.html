<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AgroCheck — Validación de calidad y documentación</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <link rel="icon" href="images/logo_agrocheck.png" />
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body class="bg-white text-slate-800">
  <header class="w-full border-b border-slate-200 bg-white sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img id="logo-img" src="images/logo_agrocheck.png" alt="AgroCheck" class="w-10 h-10 rounded-lg"/>
        <div>
          <h1 class="text-xl font-semibold">AgroCheck</h1>
          <p class="text-xs text-slate-500">Plataforma web con IA para validación de calidad y documentación</p>
        </div>
      </div>
      <nav class="flex items-center gap-3">
        <span id="usageBadge" class="hidden text-xs bg-emerald-50 text-emerald-700 px-2.5 py-1 rounded-full"></span>
        <button id="btnLogin" class="px-4 py-2 rounded-xl border border-slate-300 hover:bg-slate-50">Iniciar sesión</button>
        <button id="btnLogout" class="hidden px-4 py-2 rounded-xl bg-slate-900 text-white hover:bg-slate-800">Cerrar sesión</button>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <section id="about" class="mb-8">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2">
          <h2 class="text-2xl font-semibold mb-2">¿Qué es AgroCheck?</h2>
          <p class="text-slate-600 mb-2">
            Plataforma simple y económica para productores y exportadores. Sube tus <strong>lotes</strong> y
            <strong>documentos</strong>, usa el <strong>asistente IA</strong> (Jotform) y emite una
            <strong>Constancia de Aprobación</strong> cuando todo esté correcto.
          </p>
        </div>
        <div class="bg-emerald-50 rounded-2xl p-4">
          <h3 class="font-semibold mb-1">Ayuda</h3>
          <p class="text-sm text-emerald-900">
            Sube tu documentación y nuestra IA verificará si está correctamente llenada. Administra tus lotes
            y descarga constancias de aprobación en PDF.
          </p>
        </div>
      </div>
    </section>

    <!-- Auth -->
    <section id="authCard" class="mb-8">
      <div class="grid md:grid-cols-2 gap-6">
        <div class="rounded-2xl border border-slate-200 p-5">
          <h3 class="text-lg font-semibold mb-3">Iniciar sesión</h3>
          <form id="loginForm" class="space-y-3">
            <input type="email" id="loginEmail" placeholder="Correo" class="w-full px-3 py-2 border rounded-lg" required />
            <input type="password" id="loginPassword" placeholder="Contraseña" class="w-full px-3 py-2 border rounded-lg" required />
            <button type="submit" class="w-full bg-slate-900 text-white rounded-xl py-2">Entrar</button>
          </form>
          <p id="authDiag" class="mt-3 text-xs text-slate-500 break-words"></p>
        </div>
        <div class="rounded-2xl border border-slate-200 p-5">
          <h3 class="text-lg font-semibold mb-3">Crear cuenta</h3>
          <form id="signupForm" class="space-y-3">
            <input type="text" id="signupName" placeholder="Nombre o empresa" class="w-full px-3 py-2 border rounded-lg" required />
            <input type="email" id="signupEmail" placeholder="Correo" class="w-full px-3 py-2 border rounded-lg" required />
            <input type="password" id="signupPassword" placeholder="Contraseña" class="w-full px-3 py-2 border rounded-lg" required />
            <div>
              <p class="font-medium mb-2">Elige plan</p>
              <div class="grid grid-cols-3 gap-3 text-sm">
                <label class="border rounded-xl p-3 flex flex-col gap-1 cursor-pointer">
                  <input type="radio" name="plan" value="BASICO" class="mr-2" checked />
                  <span class="font-semibold">Básico</span>
                  <span>30 usos IA/mes</span>
                </label>
                <label class="border rounded-xl p-3 flex flex-col gap-1 cursor-pointer">
                  <input type="radio" name="plan" value="PRO" class="mr-2" />
                  <span class="font-semibold">Pro</span>
                  <span>200 usos IA/mes</span>
                </label>
                <label class="border rounded-xl p-3 flex flex-col gap-1 cursor-pointer">
                  <input type="radio" name="plan" value="EMPRESA" class="mr-2" />
                  <span class="font-semibold">Empresa</span>
                  <span>1000 usos IA/mes</span>
                </label>
              </div>
            </div>
            <button type="submit" class="w-full bg-emerald-600 text-white rounded-xl py-2">Registrarme</button>
          </form>
        </div>
      </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="hidden">
      <div class="rounded-2xl border border-slate-200 p-5 mb-6">
        <h3 class="text-lg font-semibold mb-4">1) Datos del lote</h3>
        <form id="lotForm" class="grid md:grid-cols-3 gap-4">
          <div>
            <label class="text-sm">Producto</label>
            <select id="lotProduct" class="w-full px-3 py-2 border rounded-lg" required></select>
          </div>
          <div>
            <label class="text-sm">Variedad</label>
            <input id="lotVariety" class="w-full px-3 py-2 border rounded-lg" placeholder="Hass, Red Globe, etc." required />
          </div>
          <div>
            <label class="text-sm">Código de lote</label>
            <input id="lotCode" class="w-full px-3 py-2 border rounded-lg" placeholder="Lote-001" required />
          </div>
          <div>
            <label class="text-sm">Región de origen</label>
            <input id="lotRegion" class="w-full px-3 py-2 border rounded-lg" placeholder="Ej. La Libertad" />
          </div>
          <div>
            <label class="text-sm">Provincia de origen</label>
            <input id="lotProvince" class="w-full px-3 py-2 border rounded-lg" placeholder="Ej. Trujillo" />
          </div>
          <div>
            <label class="text-sm">País de destino</label>
            <select id="lotCountry" class="w-full px-3 py-2 border rounded-lg" required></select>
          </div>
          <div class="md:col-span-3">
            <button class="bg-slate-900 text-white rounded-xl px-4 py-2">Guardar lote</button>
          </div>
        </form>
      </div>

      <div class="rounded-2xl border border-slate-200 p-5 mb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">2) Requisitos y documentos</h3>
          <button id="btnRefreshReqs" class="px-3 py-1.5 text-sm rounded-lg border">Actualizar requisitos</button>
        </div>
        <div id="reqList" class="grid md:grid-cols-3 gap-4"></div>
        <div class="mt-4">
          <label class="text-sm block mb-1">Fotos del lote (opcional)</label>
          <input type="file" id="lotPhotos" multiple accept="image/*" class="w-full" />
        </div>
      </div>

      <div class="rounded-2xl border border-slate-200 p-5 mb-6">
        <h3 class="text-lg font-semibold mb-2">3) Asistente IA</h3>
        <iframe id="JotFormIFrame-019976d2787977db8407f112aba48e371006"
          title="Registro para capacitación Agente de IA" onload="window.parent.scrollTo(0,0)"
          allowtransparency="true" allow="geolocation; microphone; camera; fullscreen"
          src="https://agent.jotform.com/019976d2787977db8407f112aba48e371006?embedMode=iframe&background=1&shadow=1"
          frameborder="0" style="max-width:100%; height:688px; border:none; width:100%;" scrolling="no">
        </iframe>
        <script src='https://cdn.jotfor.ms/s/umd/latest/for-form-embed-handler.js'></script>
        <script>
          window.jotformEmbedHandler("iframe[id='JotFormIFrame-019976d2787977db8407f112aba48e371006']", "https://www.jotform.com");
        </script>
      </div>

      <div class="rounded-2xl border border-slate-200 p-5 mb-6">
        <h3 class="text-lg font-semibold mb-2">4) Resultado de revisión</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <div>
            <label class="text-sm">¿Aprobado?</label>
            <select id="lotApproved" class="w-full px-3 py-2 border rounded-lg">
              <option value="">Selecciona</option>
              <option value="true">Sí</option>
              <option value="false">No</option>
            </select>
          </div>
          <div class="md:col-span-2">
            <label class="text-sm">Observaciones</label>
            <input id="lotObs" class="w-full px-3 py-2 border rounded-lg" placeholder="Comentarios o hallazgos" />
          </div>
        </div>
        <div class="flex items-center gap-3 mt-4">
          <button id="btnSaveResult" class="bg-emerald-600 text-white rounded-xl px-4 py-2">Guardar resultado + contar uso IA</button>
          <button id="btnPDF" class="hidden border rounded-xl px-4 py-2">Generar constancia PDF</button>
        </div>
      </div>

      <div class="rounded-2xl border border-slate-200 p-5">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold">Tus lotes</h3>
          <button id="btnReloadLots" class="px-3 py-1.5 text-sm rounded-lg border">Actualizar</button>
        </div>
        <div id="lotsTable" class="overflow-x-auto text-sm"></div>
      </div>
    </section>
  </main>

  <footer class="max-w-6xl mx-auto px-4 py-10 text-center text-xs text-slate-500">
    © <span id="year"></span> AgroCheck. Todos los derechos reservados.
  </footer>

  <script src="assets/js/env.js"></script>
  <script src="assets/js/supabaseClient.js"></script>
  <script src="assets/js/certificate.js"></script>
  <script src="assets/js/app.js"></script>
</body>
</html>
